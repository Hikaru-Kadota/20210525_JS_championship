<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>

  <div>ä»Šæ—¥ã¯<span class="dayWeather"></span>ã€æ°—æ¸©ã¯<span class="nowTemp"></span>åº¦</div>
  <div>æ˜æ—¥ã¯<span class="tomorrowWeather"></span>ã€æ°—æ¸©ã¯<span class="tomorrowTemp"></span>åº¦</div>
  <div>3æ—¥å¾Œã¯<span class="dayAfterTomorrowWeather"></span>ã€æ°—æ¸©ã¯<span class="dayAfterTomorrowTemp"></span>åº¦</div>
  <div>4æ—¥å¾Œã¯<span class="threeDaysLaterWeather"></span>ã€æ°—æ¸©ã¯<span class="threeDaysLaterTemp"></span>åº¦</div>
  <div>5æ—¥å¾Œã¯<span class="fourDaysLaterWeather"></span>ã€æ°—æ¸©ã¯<span class="fourDaysLaterTemp"></span>åº¦</div>
  <div>6æ—¥å¾Œã¯<span class="fiveDaysLaterWeather"></span>ã€æ°—æ¸©ã¯<span class="fiveDaysLaterTemp"></span>åº¦</div>




  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script>


    $(document).ready(function () {
      'use strict'

      const APIKEY = "99e9fe4e103779f3e7f4906e498ef3b7";

      //ç¿Œæ—¥9æ™‚ã®ãƒ‡ãƒ¼ã‚¿ã®å ´æ‰€ã‚’å‰²ã‚Šå‡ºã™
      const date = new Date();
      const nowHour = date.getHours();
      const whichTomorrowWeatherData = Math.floor((24 - nowHour + 9) / 3);
      const whichDayAfterTomorrowWeatherData = Math.floor((24 - nowHour + 33) / 3);
      const threeDaysLaterData = Math.floor((24 - nowHour + 57) / 3);
      const fourDaysLaterData = Math.floor((24 - nowHour + 81) / 3);
      const fiveDaysLaterData = Math.floor((24 - nowHour + 105) / 3);
      const sixDaysLaterData = Math.floor((24 - nowHour + 114) / 3);


      //ç¾åœ¨ä½ç½®ã®å–å¾—ãŒã§ãã‚‹ã‹ã©ã†ã‹
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(success, error);

        // ç¾åœ¨ä½ç½®ã®å–å¾—ã«æˆåŠŸã—ãŸå ´åˆ
        function success(position) {
          const positionData = position.coords;

          //ç·¯åº¦çµŒåº¦ã®å–å¾—ã¨è¡¨ç¤º
          const lat = positionData.latitude;
          const lon = positionData.longitude;
          $('.location').text('ç¾åœ¨ã®ä½ç½®ï¼ˆ' + Math.floor(lat * 100) / 100 + ',' + Math.floor(lon * 100) / 100 + ')');


          //ç¾åœ¨ã®å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã‚’å‘¼ã³å‡ºã—
          $.ajax({
            url: "http://api.openweathermap.org/data/2.5/weather",
            dataType: "jsonp",
            data: "lat=" + lat + "&lon=" + lon + "&appid=" + APIKEY,
            //å¤©æ°—ãƒ‡ãƒ¼ã‚¿å‘¼ã³å‡ºã—æˆåŠŸæ™‚ã®æŒ™å‹•
            success: function (data) {
              if (data.weather[0].main === "Clear") {
                $('.dayWeather').text("æ™´ã‚Œ");
              } else if (data.weather[0].main === "Rain") {
                $('.dayWeather').text("é›¨");
              } else if (data.weather[0].main === "Clouds") {
                $('.dayWeather').text("ãã‚‚ã‚Š");
              } else if (data.weather[0].main === "Snow") {
                $('.dayWeather').text("é›ª");
              }

              //å„ãƒ‡ãƒ¼ã‚¿ã®è¡¨ç¤º
              $('.nowTemp').text(Math.floor((data.main.temp - 273.15) * 10) / 10);
            }
          });

          //æ˜æ—¥ã®å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã‚’å‘¼ã³å‡ºã—
          $.ajax({
            url: "http://api.openweathermap.org/data/2.5/forecast",
            dataType: "jsonp",
            data: "lat=" + lat + "&lon=" + lon + "&appid=" + APIKEY,
            //å¤©æ°—ãƒ‡ãƒ¼ã‚¿å‘¼ã³å‡ºã—æˆåŠŸæ™‚ã®æŒ™å‹•
            success: function (data) {
              //ç¿Œæ—¥9æ™‚ã®å¤©æ°—ãƒ‡ãƒ¼ã‚¿
              const targetData1 = data.list[whichTomorrowWeatherData];
              const targetData2 = data.list[whichDayAfterTomorrowWeatherData];
              const targetData3 = data.list[threeDaysLaterData];
              const targetData4 = data.list[fourDaysLaterData];
              const targetData5 = data.list[fiveDaysLaterData];
              const targetData6 = data.list[sixDaysLaterData];






              //å®®å·ã•ã‚“ãŒå¿…è¦ã¨ãªã‚‹ã‚¨ãƒªã‚¢ğŸ‘‡ğŸ‘‡

              ///æ™´ã‚Œã¨ã‹æ›‡ã‚Šã¨ã‹ã‚’è¡¨ç¤ºã•ã›ã‚‹å‡¦ç†------------------------------------------------------------------------------
              if (targetData1.weather[0].main === "Clear") {
                $('.tomorrowWeather').text("æ™´ã‚Œ");
              } else if (targetData1.weather[0].main === "Rain") {
                $('.tomorrowWeather').text("é›¨");
              } else if (targetData1.weather[0].main === "Clouds") {
                $('.tomorrowWeather').text("ãã‚‚ã‚Š");
              } else if (targetData1.weather[0].main === "Snow") {
                $('.tomorrowWeather').text("é›ª");
              }

              if (targetData2.weather[0].main === "Clear") {
                $('.dayAfterTomorrowWeather').text("æ™´ã‚Œ");
              } else if (targetData2.weather[0].main === "Rain") {
                $('.dayAfterTomorrowWeather').text("é›¨");
              } else if (targetData2.weather[0].main === "Clouds") {
                $('.dayAfterTomorrowWeather').text("ãã‚‚ã‚Š");
              } else if (targetData2.weather[0].main === "Snow") {
                $('.dayAfterTomorrowWeather').text("é›ª");
              }

              if (targetData3.weather[0].main === "Clear") {
                $('.threeDaysLaterWeather').text("æ™´ã‚Œ");
              } else if (targetData3.weather[0].main === "Rain") {
                $('.threeDaysLaterWeather').text("é›¨");
              } else if (targetData3.weather[0].main === "Clouds") {
                $('.threeDaysLaterWeather').text("ãã‚‚ã‚Š");
              } else if (targetData3.weather[0].main === "Snow") {
                $('.threeDaysLaterWeather').text("é›ª");
              }

              if (targetData4.weather[0].main === "Clear") {
                $('.fourDaysLaterWeather').text("æ™´ã‚Œ");
              } else if (targetData4.weather[0].main === "Rain") {
                $('.fourDaysLaterWeather').text("é›¨");
              } else if (targetData4.weather[0].main === "Clouds") {
                $('.fourDaysLaterWeather').text("ãã‚‚ã‚Š");
              } else if (targetData4.weather[0].main === "Snow") {
                $('.fourDaysLaterWeather').text("é›ª");
              }

              if (targetData5.weather[0].main === "Clear") {
                $('.fiveDaysLaterWeather').text("æ™´ã‚Œ");
              } else if (targetData5.weather[0].main === "Rain") {
                $('.fiveDaysLaterWeather').text("é›¨");
              } else if (targetData5.weather[0].main === "Clouds") {
                $('.fiveDaysLaterWeather').text("ãã‚‚ã‚Š");
              } else if (targetData5.weather[0].main === "Snow") {
                $('.fiveDaysLaterWeather').text("é›ª");
              }

              if (targetData6.weather[0].main === "Clear") {
                $('.sixDaysLaterWeather').text("æ™´ã‚Œ");
              } else if (targetData6.weather[0].main === "Rain") {
                $('.sixDaysLaterWeather').text("é›¨");
              } else if (targetData6.weather[0].main === "Clouds") {
                $('.sixDaysLaterWeather').text("ãã‚‚ã‚Š");
              } else if (targetData6.weather[0].main === "Snow") {
                $('.sixDaysLaterWeather').text("é›ª");
              }


              ///æ°—æ¸©ã‚’è¡¨ç¤ºã™ã‚‹å‡¦ç†------------------------------------------------------------------------------
              $('.tomorrowTemp').text(Math.floor((targetData1.main.temp - 273.15) * 10) / 10);
              $('.dayAfterTomorrowTemp').text(Math.floor((targetData2.main.temp - 273.15) * 10) / 10);
              $('.threeDaysLaterTemp').text(Math.floor((targetData3.main.temp - 273.15) * 10) / 10);
              $('.fourDaysLaterTemp').text(Math.floor((targetData4.main.temp - 273.15) * 10) / 10);
              $('.fiveDaysLaterTemp').text(Math.floor((targetData5.main.temp - 273.15) * 10) / 10);
              $('.sixDaysLaterTemp').text(Math.floor((targetData6.main.temp - 273.15) * 10) / 10);

              //-----------------------------------------------------------------------------------------------
            }
          });
        }








        //ç¾åœ¨ä½ç½®ã®å–å¾—ã«å¤±æ•—ã—ãŸå ´åˆ
        function error(error) {

        }
        //ç¾åœ¨ä½ç½®ãŒãã‚‚ãã‚‚å–å¾—ã§ããªã„å ´åˆ
      } else {

      }

    }());
  </script>


</body>

</html>