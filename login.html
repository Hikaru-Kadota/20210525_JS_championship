<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/user_signUp.css">
  <title>Log_In</title>
  <!-- この下にAPI KEY -->

</head>

<body>

  <div class="background">
    <div>
      <h2>ろぐいん</h2>
    </div>

    <div class="input_container">
      <div>
        <p id="error_message_0" class="error_message"></p>
      </div>

      <div>
        <h3>ユーザー名</h3>
        <input type="text" id='input_name' placeholder="ユーザー名(６文字以上)">
        <p id="error_message_1" class="error_message"></p>
        <p id="error_message_4" class="error_message"></p>
      </div>
      <div>
        <h3>パスワード</h3>
        <input type="password" id='input_password' placeholder="password">
      </div>
      <div>
        <h3>パスワード (もういっちょ)</h3>
        <input type="password" id="input_password_confirmation" placeholder="password_confirmation">
        <p id="error_message_3" class="error_message"></p>
      </div>
    </div>

    <div class="btn">
      <div class="signUp_btn">
        <a id="log_in">ポチッとな</a>
      </div>
      <div class="else_btn">
        <div>
          <a href="index.html">とっぷ</a>
        </div>
        <div>
          <a href="sign_up.html">とうろく</a>
        </div>
      </div>
    </div>



    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase.js"></script>
    <script>
      var firebaseConfig = {
        apiKey: "AIzaSyD_NCLw8CRs6EtqVYsoUa6_cAGFArGhxXI",
        authDomain: "favorite-point.firebaseapp.com",
        projectId: "favorite-point",
        storageBucket: "favorite-point.appspot.com",
        messagingSenderId: "1047961614364",
        appId: "1:1047961614364:web:2b98538b617a96648e87d9"
      };
      firebase.initializeApp(firebaseConfig);
      const user_info = firebase.firestore().collection('User_info');
      const logedIn_user = firebase.firestore().collection('logedIn_user');
    </script>

    <script>
      // 登録ボタンを押してfirebaseに保存する処理
      $('#log_in').on('click', function () {
        const input_data = {
          name: $('#input_name').val(),
          password: $('#input_password').val(),
          password_confirmation: $('#input_password_confirmation').val(),
        };
        $('#input_name').val('');
        $('#input_password').val('');
        $('#input_password_confirmation').val('');

        // 表示ボタンを押して、firebaseから必要なデータだけを取り出して表示する処理(自分の投稿データ)


        user_info.onSnapshot(function (querySnapshot) {
          const dataArray = [];
          querySnapshot.docs.forEach(function (doc) {
            const login_data = {
              id: doc.id,
              data: doc.data(),
            };
            dataArray.push(login_data);
          });
          const tagArray = [];
          dataArray.forEach(function (data) {
            tagArray.push({
              id: data.id,
              password: data.data.password,
              name: data.data.name
            })
          })
          let targetUser = tagArray.find((v) => v.name === input_data.name);

          if (targetUser != null && targetUser.password == input_data.password && input_data.password == input_data.password_confirmation) {
            logedIn_userData = {
              name: targetUser.name
            };
            $('#error_message_0').text(logedIn_userData.name + 'さん　こんにちわ');
            logedIn_user.add(logedIn_userData);
            console.log(logedIn_userData.name);
            const time_out = function () {
              window.location.href = 'post.html?' + logedIn_userData.name;
            };
            setTimeout(time_out, 1500);
          } else {
            $('#error_message_0').text('ログインできませんでした');
          }
        });
      });


    </script>

</body>

</html>